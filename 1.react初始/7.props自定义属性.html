<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <!-- 1. DOMç»“æ„ -->
    <div id="App" ></div>

    <script>
        // 4.å…¬å…±æ¨¡å— Component
        class Component {
            constructor() {
                // 4.Dom å…ƒç´ å®¹å™¨
                this.elBtn = '';
            }
            // 2.5 ä¿®æ”¹Dom
            onChenges() {
                this.setState({
                    isLiked: !this.state.isLiked
                })
            }
            // 2.6 è®¾ç½®stateçŠ¶æ€æ–¹æ³•
            setState(newState = {}) {
                this.state = newState
                // 2.7ç¼“å­˜æˆ‘ä»¬æ—§çš„Dom 
                var oldEl = this.elBtn
                // 2.8ç”Ÿæˆä¸€ä¸ªæ–°çš„Dom
                var newEl = this._render()
                // 2.9è·å–çˆ¶çº§å…ƒç´ 
                if (this.changeRender) {
                    this.changeRender(oldEl, newEl)
                }
            }
            // 2.1ç”ŸæˆDomå…ƒç´ æ–¹æ³•
            renderDomFromString(string) {
                var div = document.createElement('div');
                div.innerHTML = string
                return div
            };
            // 4.7ç§æœ‰æ–¹æ³•ç”ŸæˆDom å…ƒç´ ï¼Œå¹¶ä¸”ç»‘å®šäº‹ä»¶
            _render() {
                // 2.3ç»‘å®šäº‹ä»¶
                this.elBtn = this.renderDomFromString(this.render())

                this.elBtn.addEventListener('click', this.onChenges.bind(this))

                // è¿”å›åˆ›å»ºçš„div
                return this.elBtn
            }
        }

        // 2.ä½¿ç”¨class åŒ…è£…DOM å…ƒç´ 
        class FDomBTn extends Component {
            // 2.4åˆå§‹çŠ¶æ€æ•°æ®
            constructor(props={}) {
                // 4.6åœ¨å­é›†ç±»ä¸­å¿…é¡»ä½¿ç”¨superæ–¹æ³•å»å®åŠ›åŒ–æˆ‘ä»¬çš„çˆ¶çº§ å¿…é¡»åœ¨å®ä¾‹åŒ–å¾—é¡¶å±‚è°ƒç”¨
                super(props)
                this.props = props
                this.state = {
                    isLiked: false
                }
                // DICT å­—å…¸ é‡Œé¢éƒ½æ˜¯å¤§å†™ å°±æ˜¯å¸¸é‡
                this.DICT = {
                    DZ:'ç‚¹èµ',
                    QXZ:'å–æ¶ˆç‚¹èµ'
                }
            };
            render() {
                // æ ¹æ®ä¼ å…¥çš„props å±æ€§æ¥åŠ¨æ€æ¸²æŸ“æˆ‘ä»¬çš„dom æ ·å¼ï¼Œä½¿ç”¨stateæ”¹å˜æˆ‘ä»¬çš„domå†…å®¹
                return `
                <button class="link-btn" style="color:${this.state.isLiked?this.props.colorred:this.props.colorpink}; background:${this.props.bgcolor};">
                    <span class="link-text">${this.state.isLiked ? this.DICT.QXZ  : this.DICT.DZ}</span>
                    <span>ğŸ‘</span>
                </button>
                `
            }
        };
        // 3.æŒ‚è½½-æ¸²æŸ“
        const mount = (Component, Root) => {
            // 3.3 ç¬¬ä¸€æ¬¡æŒ‚è½½
            Root.appendChild(Component._render())
            // 3.4è·Ÿæ–°Dom
            Component.changeRender = (oldEl, newEl) => {
                Root.insertBefore(newEl, oldEl);
                Root.removeChild(oldEl)
            }
        }
        //    æµ‹è¯•
        mount(new FDomBTn({colorred:'red',colorpink:'pink',bgcolor:'#19f92fa'}),document.getElementById('App'))

    </script>
</body>

</html>